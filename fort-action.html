<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../fort-icon/fort-icon.html">
<link rel="import" href="../paper-ripple/paper-ripple.html">
<link rel="import" href="../paper-material/paper-material-shared-styles.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <fort-action>iron:icons:star</fort-action>

@demo demo/index.html
-->

<dom-module id="fort-action" attributes="size elevation">
  <template strip-whitespace>
    <style include="paper-material-shared-styles">
      :host {
        position: relative;
        box-sizing: border-box;
        background: transparent;
        -webkit-tap-highlight-color: transparent;
        outline: none;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
        cursor: pointer;
        z-index: 0;
        padding: 8px;
        display: inline-flex;
        font-size: var(--fort-icon-size);
      }

      paper-ripple {
        color: var(--paper-button-ink-color);
      }
    </style>

    <template strip-whitespace is="dom-if" if="{{_icon}}">
      <fort-icon size="[[size]]">{{_icon}}</fort-icon>
    </template>
    <template strip-whitespace is="dom-if" if="{{!_icon}}">
      <content></content>
    </template>
    <paper-ripple center class="circle"></paper-ripple>
  </template>
  <script>
    Polymer(
      {
        is:           'fort-action',
        properties:   {
          size: {
            type:     Number,
            value:    24,
            observer: '_sizeChanged'
          }
        },
        _icon:        '',
        _sizeChanged: function ()
                      {
                        // remove any non-numeric characters, ready to append px for styles
                        var defaultSize = 24;
                        this.size = (this.size || defaultSize) || defaultSize;
                        this.updateStyles({'--fort-icon-size': this.size + 'px'});
                      },
        ready:        function ()
                      {
                        this.async(this._updateType);
                        new MutationObserver(this._updateType.bind(this))
                          .observe(this, {childList: true, subtree: true, characterData: true});
                      },
        _updateType:  function ()
                      {
                        var urlPattern = new RegExp(
                            /^(https?:\/\/)?/.source + // protocol
                            '(' +
                            /(([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}/.source + // domain name
                            /((\d{1,3}\.){3}\d{1,3})/.source + // OR ip (v4) address
                            /(:\d+)?/.source // port
                            + ')?' +
                            /(\.{0,2}?\/[a-z\d%_.~+\/\-]+)/.source + // path
                            /(\?[;&a-z\d%_.~+=-]*)?/.source + // query string
                            /(#[-a-z\d_]*)?$/.source // hash
                          , 'i'
                          ),
                          ironIconPattern = new RegExp('^[a-z0-9\-]+\:[a-z0-9\-]+$'),
                          text = this.getEffectiveTextContent().trim();

                        if((urlPattern.test(text) || ironIconPattern.test(text))
                          && this.getEffectiveChildren().length == 0)
                        {
                          this._icon = text;
                        }
                        else
                        {
                          this._icon = '';
                        }
                      }
      }
    );
  </script>
</dom-module>
